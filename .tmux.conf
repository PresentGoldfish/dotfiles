##### Basics (tmux 3.5a) ###############################################

# Reload config
bind r source-file ~/.tmux.conf \; display-message "~/.tmux.conf reloaded"

# Prefix = Ctrl-Space
set -g prefix C-Space
unbind C-b
bind C-Space send-prefix

# General ergonomics
set -g mouse on
set -g history-limit 100000
set -sg escape-time 25
set -g focus-events on
set -g renumber-windows on
set -g base-index 1
setw -g pane-base-index 1
setw -g mode-keys vi

##### Enhanced Clipboard Integration ###################################

# OSC 52 clipboard support
set -g set-clipboard on
set -g allow-passthrough on  # For tmux 3.3a+

# Plugins for enhanced clipboard integration
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'

# tmux-yank configuration
set -g @yank_selection_mouse 'clipboard'
# set -g @yank_action 'copy-pipe'  # Uncomment to stay in copy mode

##### Splits & Pane control ###########################################

# Sane splits (preserve CWD)
unbind '"'
unbind %
bind v  split-window -h -c "#{pane_current_path}"
bind '-' split-window -v -c "#{pane_current_path}"
bind '\' split-window -h -c "#{pane_current_path}"
bind b  split-window -v -c "#{pane_current_path}"

# Move with hjkl; resize with HJKL (repeatable)
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# New window keeps CWD
bind c new-window -c "#{pane_current_path}"

##### Enhanced Copy & Paste ############################################

# Vim-like copy flow with tmux-yank integration
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel

# Mouse: first scroll enters copy-mode; then pass through
bind -n WheelUpPane   if-shell -F "#{pane_in_mode}" "send-keys -M" "copy-mode -e \; send-keys -M"
bind -n WheelDownPane if-shell -F "#{pane_in_mode}" "send-keys -M" "send-keys -M"

##### Titles / renaming ################################################

setw -g automatic-rename on
set -g automatic-rename-format "#{b:pane_current_path} Â· #{b:pane_current_command}"
set -g set-titles on

##### Status line (minimal + highlight active window) ##################

set -g status-style bg=default
set -g status-left '#{?client_prefix,#[reverse]<C-Space>#[noreverse] ,}[#S] '
set -g status-right '#{b:pane_current_path} | #{b:pane_current_command} | %Y-%m-%d %H:%M'
set -g status-right-length 100
set -g status-left-length 50

# Highlight active window in the status bar
set -g window-status-style "bg=default,fg=brightblack"
set -g window-status-current-style "bg=brightblue,fg=black,bold"
set -g window-status-format " #I:#W "
